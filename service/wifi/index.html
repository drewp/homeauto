<!doctype html>
<html>

<head>
  <title>wifi</title>
  <meta charset="utf-8">
  <script src="/lib/polymer/1.0.9/webcomponentsjs/webcomponents.min.js"></script>
  <script src="/lib/require/require-2.3.3.js"></script>
  <script src="/rdf/common_paths_and_ns.js"></script>

  <link rel="stylesheet" href="/rdf/browse/style.css">

  <link rel="import" href="/rdf/streamed-graph.html">
  <link rel="import" href="/lib/polymer/1.0.9/polymer/polymer.html">
</head>

<body class="rdfBrowsePage">
  <template id="t" is="dom-bind">
    <style>
     body {
         background: black;
         color: white;
     }
     a {
         color: #b1b1fd;
         text-shadow: 1px 1px 0px #0400ff94;
         text-decoration-color: #00007714;
     }
     #subjectRequest {
         width: 50em;
     }
    </style>

    <streamed-graph url="/sse_collector/graph/network" graph="{{graph}}"></streamed-graph>
    <div id="out">
    </div>

    <script type="module">
      import { render } from '/lib/lit-html/1.0.0/lit-html.js';
      import { graphView } from './wifi.js';
      const sg = document.querySelector('streamed-graph');

      const out = document.querySelector('#out');
      const startPainting = () => {
        if (!sg.graph || !sg.graph.graph) {
          setTimeout(startPainting, 100);
          return;
        }

        let dirty = true;

        const repaint = () => {
          if (!dirty) {
            return;
          }
          render(graphView(sg.graph.graph), out);
          dirty = false;
        };

        sg.addEventListener('graph-changed', (ev) => {
          dirty = true;
          requestAnimationFrame(repaint);
        });
        repaint();
      };
      setTimeout(startPainting, 10);
    </script>
  </template>
  <script>

  </script>
</body>

</html>
